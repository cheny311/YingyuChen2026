<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yingyu Chen - Portfolio</title>
    <script src="https://cdn.jsdelivr.net/npm/p5@1.11.10/lib/p5.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/p5@1.11.10/lib/addons/p5.sound.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tomorrow:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="sketch.js" defer></script>
    <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
    <div class="container">
        
        <div class="top-section">
            <header class="main-header">
                <h1 class="title-large">Hahaha</h1>
                <p class="subtitle">automated laughter</p>
            </header>
            
            <nav class="project-sidebar">
                <span class="list-label">project list</span>
                <ul>
                    <li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li>
                    <li>8</li><li>9</li><li>10</li><li>11</li><li>12</li><li>13</li><li>14</li>
                </ul>
            </nav>
        </div>

        <main class="gallery-section">
           
    <div class="ha-svg-wrapper">
        <main class="content-middle">
    <div class="box-img left-img" id="p5-container"></div>

    <div class="ha-character">
        <img src="ha.svg" alt="哈" class="ha-svg-file">
    </div>

    <div class="box-img video-box video-1">
        <div class="ha-video">
            <video id="ha-video-1" src="h.mp4" autoplay loop muted playsinline></video>
            <div class="video-controls">
                <button id="btn-play-1">Pause</button>
                <button id="btn-mute-1">Unmute</button>
                <label class="volume-label">Vol
                    <input id="volume-slider-1" type="range" min="0" max="1" step="0.05" value="0.5">
                </label>
            </div>
        </div>
    </div>

    <div class="box-img video-box video-2">
        <div class="ha-video">
            <video id="ha-video-2" src="hahaha.mp4" autoplay loop muted playsinline></video>
            <div class="video-controls">
                <button id="btn-play-2">Pause</button>
                <button id="btn-mute-2">Unmute</button>
                <label class="volume-label">Vol
                    <input id="volume-slider-2" type="range" min="0" max="1" step="0.05" value="0.5">
                </label>
            </div>
        </div>
    </div>
</main>
            </div>
        </main>

       <div class="photo-frame">
        <p>click to see more</p>
  <a href="detail.html">
    <img src="h32.JPG" alt="photo" class="photo-img">
  </a>
</div>

        <section class="footer-content">
            <div class="vertical-text-group">
                <div class="v-text">2D version</div>
                <div class="v-text">Interaction demo</div>
            </div>

            <div class="main-paragraph">
                <p>大段落文字是非成败转头空，青山依旧在，惯看秋月春风。一壶浊酒喜相逢，古今多少事，滚滚长江东逝水，浪花淘尽英雄。几度夕阳红。白是非成败转头空，青山依旧在，惯看秋月春风。一壶浊酒喜相逢，古今多少事，滚滚长江东逝水，浪花淘尽英雄。</p>
            </div>

            <div class="side-paragraph">
                <p>是非成败转头空，青山依旧在，惯看秋月春风。一壶浊酒喜相逢，古今多少事，滚滚长江东逝水，浪花淘尽英雄。几度夕阳红。白发渔樵江渚上，都付笑谈中。</p>
            </div>
        </section>

        <footer class="bottom-nav">
            <a href="../contact.html">contact</a>
      <a href="../index.html">home</a>
      <a href="read.html">README</a>
        </footer>
    </div>
</body>
<script>
document.addEventListener("DOMContentLoaded", () => {
  initVideoBox({
    boxSelector: ".video-box.video-1",
    videoId: "ha-video-1",
    playId: "btn-play-1",
    muteId: "btn-mute-1",
    volumeId: "volume-slider-1",
  });

  initVideoBox({
    boxSelector: ".video-box.video-2",
    videoId: "ha-video-2",
    playId: "btn-play-2",
    muteId: "btn-mute-2",
    volumeId: "volume-slider-2",
  });
});

function getTranslateFromStyle(el) {
  const style = getComputedStyle(el);
  const matrix = style.transform;
  if (!matrix || matrix === "none") return { x: 0, y: 0 };
  const match =
    matrix.match(/matrix\(1, 0, 0, 1, ([\-0-9.]+), ([\-0-9.]+)\)/) ||
    matrix.match(/matrix\(a, b, c, d, ([\-0-9.]+), ([\-0-9.]+)\)/) ||
    matrix.match(/translate\(([\-0-9.]+)px,\s*([\-0-9.]+)px\)/);
  if (match) {
    return { x: parseFloat(match[1]) || 0, y: parseFloat(match[2]) || 0 };
  }
  return { x: 0, y: 0 };
}

function initVideoBox(cfg) {
  const { boxSelector, videoId, playId, muteId, volumeId } = cfg;
  const box = document.querySelector(boxSelector);
  const video = document.getElementById(videoId);
  const btnPlay = document.getElementById(playId);
  const btnMute = document.getElementById(muteId);
  const volumeSlider = document.getElementById(volumeId);
  if (!box || !video) return;

  const initial = getTranslateFromStyle(box);
  box.dataset.x = initial.x.toString();
  box.dataset.y = initial.y.toString();
  box.style.transform = `translate(${box.dataset.x}px, ${box.dataset.y}px)`;

  video.volume = parseFloat(volumeSlider?.value || "0.5");

  btnPlay?.addEventListener("click", () => {
    if (video.paused) {
      video.play();
      btnPlay.textContent = "Pause";
    } else {
      video.pause();
      btnPlay.textContent = "Play";
    }
  });

  btnMute?.addEventListener("click", () => {
    video.muted = !video.muted;
    btnMute.textContent = video.muted ? "Unmute" : "Mute";
  });

  volumeSlider?.addEventListener("input", (e) => {
    const v = parseFloat(e.target.value);
    video.volume = v;
    if (video.muted && v > 0) {
      video.muted = false;
      btnMute.textContent = "Mute";
    }
  });

  // 拖拽（避免在控件上拖动）
  let dragging = false;
  let startX = 0, startY = 0;
  let baseX = 0, baseY = 0;

  const onPointerDown = (evt) => {
    if (evt.target.closest(".video-controls")) return;
    dragging = true;
    box.style.cursor = "grabbing";
    baseX = parseFloat(box.dataset.x || "0");
    baseY = parseFloat(box.dataset.y || "0");
    startX = evt.clientX;
    startY = evt.clientY;
    evt.preventDefault();
    document.addEventListener("pointermove", onPointerMove);
    document.addEventListener("pointerup", onPointerUp);
  };

  const onPointerMove = (evt) => {
    if (!dragging) return;
    const dx = evt.clientX - startX;
    const dy = evt.clientY - startY;
    const newX = baseX + dx;
    const newY = baseY + dy;
    box.style.transform = `translate(${newX}px, ${newY}px)`;
  };

  const onPointerUp = () => {
    dragging = false;
    box.style.cursor = "grab";
    const match = box.style.transform.match(/translate\(([-\d.]+)px,\s*([-\d.]+)px\)/);
    if (match) {
      box.dataset.x = match[1];
      box.dataset.y = match[2];
    }
    document.removeEventListener("pointermove", onPointerMove);
    document.removeEventListener("pointerup", onPointerUp);
  };

  box.addEventListener("pointerdown", onPointerDown);
}
</script>
</html>
